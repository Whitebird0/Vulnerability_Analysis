![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/WX20220408-220703@2x.png)

但是所有的堆申请API底层都调用同一个API

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/WX20220408-220728@2x.png)

堆的调试
---

我们如果用OD直接调试，那么查看的堆内存和程序正常运行的堆内存不一样，必须要通过实时调试来观察堆

```c
#include <windows.h>
main()
{
	HLOCAL h1,h2,h3,h4,h5,h6;
	HANDLE hp;
	hp = HeapCreate(0,0x1000,0x10000);
	__asm int 3

	h1 = HeapAlloc(hp,HEAP_ZERO_MEMORY,3);
	h2 = HeapAlloc(hp,HEAP_ZERO_MEMORY,5);
	h3 = HeapAlloc(hp,HEAP_ZERO_MEMORY,6);
	h4 = HeapAlloc(hp,HEAP_ZERO_MEMORY,8);
	h5 = HeapAlloc(hp,HEAP_ZERO_MEMORY,19);
	h6 = HeapAlloc(hp,HEAP_ZERO_MEMORY,24);
	
	HeapFree(hp,0,h1);
	HeapFree(hp,0,h3);
	HeapFree(hp,0,h5);
	
	HeapFree(hp,0,h4); 

	
	return 0;
}
```

通过int 3断点使程序崩溃，然后OD就会进入实时调试模式接管程序

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/WX20220408-223530@2x.png)

![](https://raw.githubusercontent.com/Whitebird0/tuchuang/main/WX20220408-223811@2x.png)

